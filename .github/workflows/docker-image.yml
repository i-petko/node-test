name: Docker Image CI


on:
  push:
    branches: [ master ]

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      
    - name: Build
      run: docker build --tag petko8/node-test:$GITHUB_RUN_ID .
      
    - name: Test
      run: |
        docker run --publish 7000:7000 --detach --name node-test petko8/node-test:$GITHUB_RUN_ID 
        [[ "$(curl -s localhost:7000)" == "Hello Five!" ]] || exit 1
        
    - name: Push the image
      if: ${{ success() }}
      run: docker push petko8/node-test:$GITHUB_RUN_ID
